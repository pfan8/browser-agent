%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4f46e5', 'primaryTextColor': '#fff', 'primaryBorderColor': '#4338ca', 'lineColor': '#6366f1', 'secondaryColor': '#f0abfc', 'tertiaryColor': '#c4b5fd'}}}%%
flowchart TD
    subgraph ReAct["üîÑ ReAct Loop"]
        START([‚ñ∂ START]) --> observe
        
        observe["üëÅ OBSERVE<br/><small>Capture browser state</small><br/><small>‚Ä¢ URL, Title, Content</small><br/><small>‚Ä¢ Load state (SA-01)</small><br/><small>‚Ä¢ Content hash (SA-06)</small>"]
        
        think["üß† THINK<br/><small>LLM reasoning</small><br/><small>‚Ä¢ Analyze observation</small><br/><small>‚Ä¢ Plan next action</small><br/><small>‚Ä¢ Rule fallback (RA-08)</small>"]
        
        act["‚ö° ACT<br/><small>Execute action</small><br/><small>‚Ä¢ Browser tools</small><br/><small>‚Ä¢ Retry logic (ER-02)</small><br/><small>‚Ä¢ Selector fallback (ER-01)</small>"]
    end
    
    observe -->|"continue"| think
    observe -->|"error/complete/loop"| END1([üèÅ END])
    
    think -->|"has action"| act
    think -->|"no action needed"| observe
    think -->|"error/complete/loop"| END2([üèÅ END])
    
    act -->|"continue"| observe
    act -->|"error/complete/loop"| END3([üèÅ END])
    
    subgraph Conditions["üìã Termination Conditions"]
        direction LR
        C1["RA-05: isComplete = true"]
        C2["RA-05: maxIterations reached"]
        C3["RA-06: loopDetected = true"]
        C4["RA-07: maxConsecutiveFailures"]
        C5["status = 'error'"]
    end
    
    style observe fill:#06b6d4,stroke:#0891b2,color:#fff
    style think fill:#a855f7,stroke:#9333ea,color:#fff
    style act fill:#22c55e,stroke:#16a34a,color:#fff
    style START fill:#6366f1,stroke:#4f46e5,color:#fff
    style END1 fill:#ef4444,stroke:#dc2626,color:#fff
    style END2 fill:#ef4444,stroke:#dc2626,color:#fff
    style END3 fill:#ef4444,stroke:#dc2626,color:#fff
    style ReAct fill:#f8fafc,stroke:#e2e8f0
    style Conditions fill:#fef3c7,stroke:#fcd34d